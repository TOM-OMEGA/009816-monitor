name: 009816 經理人定時戰報

on:
  schedule:
    # 台灣時間 (UTC+8) 09:00 - 14:00
    # 對應 UTC 時間為 01:00 - 06:00
    # 使用 */3 分鐘觸發一次，以對沖 GitHub 伺服器的延遲，確保體感在 5 分鐘內
    - cron: '*/3 1-6 * * 1-5'
  workflow_dispatch: # 保留手動按鈕，隨時想看數據點一下就發報

jobs:
  build:
    runs-on: ubuntu-latest
    # 避免重複任務堆積，如果上一個還在跑，就自動取消
    concurrency:
      group: ${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true

    steps:
      - name: 檢核程式碼
        uses: actions/checkout@v3

      - name: 設定 Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: 安裝必要套件
        run: |
          pip install yfinance requests pandas

      - name: 執行戰報監控
        env:
          LINE_ACCESS_TOKEN: ${{ secrets.LINE_ACCESS_TOKEN }}
          USER_ID: ${{ secrets.USER_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python main.py
